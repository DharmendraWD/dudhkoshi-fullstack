{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dharmendra/Desktop/Dudhkoshi/frontend/src/proxy.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\n\r\nconst PROTECTED_ROUTES = [\r\n  \"/admin/dashboard\",\r\n  \"/admin/hero\",\r\n  \"/admin/about\",\r\n  \"/admin/mission\",\r\n  \"/admin/team\",\r\n  \"/admin/gallery\",\r\n  \"/admin/blogs\",\r\n  \"/admin/messages\",\r\n  \"/admin/faqs\",\r\n  \"/admin/others\",\r\n  \"/admin/manage-users\",\r\n  \"/admin/change-password\",\r\n];\r\n\r\nexport default async function middleware(req) {\r\n  const { pathname } = req.nextUrl;\r\n\r\n  // Only care about admin routes\r\n  if (!pathname.startsWith(\"/admin\")) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  const isProtected = PROTECTED_ROUTES.some(route =>\r\n    pathname.startsWith(route)\r\n  );\r\n\r\n  const cookieHeader = req.headers.get(\"cookie\") || \"\";\r\n\r\n  // ðŸ‘‰ LOGIN PAGE\r\n  if (pathname === \"/admin/login\") {\r\n    try {\r\n      const res = await fetch(`${process.env.NEXT_PUBLIC_BASE_API}/me`, {\r\n        headers: {\r\n          cookie: cookieHeader,\r\n        },\r\n        credentials: \"include\",\r\n      });\r\n\r\n      // Token valid â†’ redirect to dashboard\r\n      if (res.ok) {\r\n        return NextResponse.redirect(\r\n          new URL(\"/admin/dashboard\", req.url)\r\n        );\r\n      }\r\n    } catch (err) {\r\n      // ignore\r\n    }\r\n\r\n    // Token missing / invalid â†’ allow login page\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // ðŸ‘‰ PROTECTED ROUTES\r\n  if (isProtected) {\r\n    try {\r\n      const res = await fetch(`${process.env.NEXT_PUBLIC_BASE_API}/me`, {\r\n        headers: {\r\n          cookie: cookieHeader,\r\n        },\r\n        credentials: \"include\",\r\n      });\r\n\r\n      if (!res.ok) {\r\n        throw new Error(\"Unauthorized\");\r\n      }\r\n\r\n      return NextResponse.next();\r\n    } catch (err) {\r\n      return NextResponse.redirect(\r\n        new URL(\"/admin/login\", req.url)\r\n      );\r\n    }\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: \"/admin/:path*\",\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,mBAAmB;IACvB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEc,eAAe,WAAW,GAAG;IAC1C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,+BAA+B;IAC/B,IAAI,CAAC,SAAS,UAAU,CAAC,WAAW;QAClC,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,cAAc,iBAAiB,IAAI,CAAC,CAAA,QACxC,SAAS,UAAU,CAAC;IAGtB,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;IAElD,gBAAgB;IAChB,IAAI,aAAa,gBAAgB;QAC/B,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,iEAAoC,GAAG,CAAC,EAAE;gBAChE,SAAS;oBACP,QAAQ;gBACV;gBACA,aAAa;YACf;YAEA,sCAAsC;YACtC,IAAI,IAAI,EAAE,EAAE;gBACV,OAAO,8IAAY,CAAC,QAAQ,CAC1B,IAAI,IAAI,oBAAoB,IAAI,GAAG;YAEvC;QACF,EAAE,OAAO,KAAK;QACZ,SAAS;QACX;QAEA,6CAA6C;QAC7C,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,sBAAsB;IACtB,IAAI,aAAa;QACf,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,iEAAoC,GAAG,CAAC,EAAE;gBAChE,SAAS;oBACP,QAAQ;gBACV;gBACA,aAAa;YACf;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,IAAI,MAAM;YAClB;YAEA,OAAO,8IAAY,CAAC,IAAI;QAC1B,EAAE,OAAO,KAAK;YACZ,OAAO,8IAAY,CAAC,QAAQ,CAC1B,IAAI,IAAI,gBAAgB,IAAI,GAAG;QAEnC;IACF;IAEA,OAAO,8IAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;AACX"}}]
}